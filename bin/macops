#!/bin/bash

set -e

fail() {
	echo ${1} >&2
	exit 1
}
while [[ $# -gt 0 ]]; do
	case "$1" in
		ssh) USER=${2} ; shift 2;;
		*) fail "USAGE: invalid flag '$1'"; exit 1 ;;
	esac
done

if [[ ${USER} -eq "whoami" ]]; then
	WHO=$(ls -ld ${HOME}/.ssh | cut -d'/' -f8)
	echo "Currently using .ssh profile for user '${WHO}'"
	exit 0
fi

echo "Removing current .ssh profile..."
unlink ${HOME}/.ssh
echo "Attaching to .ssh profile for user '${USER}'..."
ln -s ${HOME}/ssh/${USER} ${HOME}/.ssh
echo "Now using .ssh profile for user '${USER}'"
